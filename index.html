<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  
    <meta property="og:title" content="Writing">
    <meta property="og:site_name" content="Scott Davis">
  

  <title>Scott Davis | Software Engineer</title>
  <meta name="description" content="Software Engineer / Person
">

  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1' name='viewport'>
  <meta charset='utf-8'>
  <meta content='Scott Davis' name='author'>
  <link href='/favicon.png' rel='shortcut icon' sizes='16x16' type='image/png'>
  <link rel="stylesheet" href="/css/main.css" type='text/css'>
  <link rel='stylesheet' href="/fonts/ss-social-regular.css" type='text/css'>

  <link rel="canonical" href="http://localhost:4000/">
  <link rel="alternate" type="application/rss+xml" title="Scott Davis | Software Engineer" href="http://localhost:4000/feed.xml">
  <script>
    var _gaq = _gaq || [];
    _gaq.push(["_setAccount", "UA-9400337-1"]);
    _gaq.push(["_trackPageview"]);
    (function () {
    var e = document.createElement("script");
    e.type = "text/javascript";
    e.async = !0;
    e.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
    var t = document.getElementsByTagName("script")[0];
    t.parentNode.insertBefore(e, t)
    })();
  </script>
</head>


  <body class='group'>

    <header>
  <h1><a href="/"><img src="/images/sdlogo.svg" alt="Scott Davis"></a></h1>
  <nav>
    <ul>
      <li>
        <a href="/">writing</a>
      </li>
      <li>
        <a href="/photos">photos</a>
      </li>
      <li>
        <a href="/about">about</a>
      </li>
    </ul>
  </nav>
</header>


    <div class='gradient-bar'></div>

    <div class='group' itemscope itemtype="http://schema.org/Blog">
      <section class='main article-list '>
        <div class="blog-page">
  
    <div class='article-item full-article group ' itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      
        <h2 class="main-headline" itemprop="name headline">
          <a href="/blog/applying-domain-driven-design-principles" itemprop="url">
            Applying Domain Driven Design Principles
          </a>
        </h2>
        <span class="date">
          <time datetime="2020-05-25T21:16:37-04:00" itemprop="datePublished">
            May 25, 2020
          </time>
        </span>
        <div class='excerpt' itemprop="articleBody">
          <p>Domain Driven Design is a methodology I’ve heard about more and more over the last year, from technical book clubs to interviews. It focuses on how you design your application, including the language and naming used within it. Namely, everything should match the business domain it is serving. The book that first introduced this concept is quite long, and goes into very specific detail on how to implement this method, including it’s own specific patterns, such as entities, values, repositories, etc. Explorable Places’ domain logic started off simple years ago, but over time, the complexity grew. Our models got fat, our controllers got fat, we had business logic in a few views, it was bad and it needed to be wrangled. While I don’t think we needed to refactor the entire app to implement the very specific Domain Driven Design methodology, I think there are definitely some key learnings we can take away and apply. Specifically, we should encapsulate our business logic separately into small testable units of ‘action’, and we should name everything according to what and how the user is doing an action.</p>

<h3 id="existing-tooling">Existing Tooling</h3>

<p>There are plenty of tools that can help achieve this. Previously at eBay, we used Trooba in Node to create streamable pipelines with handlers. In Ruby, there is the popular Interactor, as well as Wisper (which is an event pub/sub based solution), and Pathway.</p>

<h3 id="pubsub">Pub/Sub</h3>

<p>Wisper was particularly interesting because DDD focuses also on events, and the app reacting to an event, which could represent a user’s action. I like this approach, but a couple things stuck out as potential issues.</p>

<ul>
  <li>
    <p>Asynchronous events: It would be nice to have these events be asynchronous, but let’s say one event completes, and triggers another event asynchronously. That second event could fail, and depending on our business logic, may need to rollback the changes of the first handler. This would be very hard to achieve, which would leave us to use the default syncronous handling.</p>
  </li>
  <li>
    <p>Tangled mess of handlers: If we are not careful, these events and handlers could expand quickly to become a tangled mess. This also makes it difficult to conceptualize just what happens when a single event is triggered, which could lead to unintended consequences when adding or editing new events.</p>
  </li>
</ul>

<h3 id="interactors">Interactors</h3>

<p>An “interactor” is basically a reimplementation of the Command Design Pattern, but specifically intended to encapsulate and manage business logic. Each interactor handles one small piece of logic, such as “send email” or “save record”. Independently, these are small, reusable, and easily testable. But rarely do we need to do something so small when a user performs some action in our app. That’s where the real power of this gem shines through. We can group multiple interactors together with an “organizer”. Each interactor has a shared context and can fail the while chain if need be. At the end, a result is returned where you can store the success or failure of the action.</p>

<p>I like this solution because we get the same benefit of something like a pub/sub solution, but we can see at a glance all that happens with a specific action and the order that they will happen in. Below I’ll go over a small example that we had that I think illustrates the usefullness of it.</p>

<h3 id="example-confirm-a-booking">Example: Confirm a booking</h3>

<p>Previously, we relied on a mix of methods defined directly on the model and ActiveRecord callbacks. Beyond that, some of them were delayed jobs, but that’s how it would “work”. Using interactors, we can define a user’s action of confirming a booking as such below. It is highly readable, and we can see the steps that are taken at each stage. If there is a failure, we can catch it and roll back any database changes. Of course, we only fail in such cases where we would want to roll back.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">ConfirmBooking</span>
  <span class="kp">include</span> <span class="no">Interactor</span><span class="o">::</span><span class="no">Organizer</span>

  <span class="n">organize</span> <span class="no">UpdateBookingStatus</span><span class="p">,</span> <span class="no">CaptureCardAuthorization</span><span class="p">,</span> <span class="no">SendMessages</span><span class="p">,</span> <span class="no">SyncCalendars</span>

  <span class="n">around</span> <span class="k">do</span> <span class="o">|</span><span class="n">organizer</span><span class="o">|</span>
    <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">transaction</span> <span class="k">do</span>
      <span class="k">begin</span>
        <span class="n">organizer</span><span class="p">.</span><span class="nf">call</span>
      <span class="k">rescue</span> <span class="no">Interactor</span><span class="o">::</span><span class="no">Failure</span>
        <span class="k">raise</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Rollback</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">call</span>
    <span class="n">context</span><span class="p">.</span><span class="nf">status_event</span> <span class="o">=</span> <span class="ss">:confirm</span>
    <span class="n">context</span><span class="p">.</span><span class="nf">message_times</span> <span class="o">=</span> <span class="p">[</span><span class="ss">:confirmation_complete</span><span class="p">]</span>
    <span class="k">super</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>I want to point out the language used also. Each interactor defined uses the natural language we use when talking about the product. We update the booking status to confirmed. We capture the credit card authorization, send messages to users, and sync calendars with updated events. We can clearly see what happens whenever we confirm any booking.</p>

<p>And in our controller, we now have a very succinct action method:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">confirm</span>
  <span class="n">booking</span> <span class="o">=</span> <span class="no">Booking</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">booking_params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>

  <span class="n">result</span> <span class="o">=</span> <span class="no">ConfirmBooking</span><span class="p">.</span><span class="nf">call</span><span class="p">({</span> <span class="ss">booking: </span><span class="n">booking</span> <span class="p">})</span>
  <span class="vi">@booking</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="nf">booking</span>

  <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="nf">success?</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_back</span> <span class="ss">fallback_location: </span><span class="n">root_path</span><span class="p">,</span> <span class="ss">notice: </span><span class="s1">'Booking was successfully confirmed.'</span> <span class="p">}</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">status: </span><span class="mi">200</span><span class="p">,</span> <span class="ss">json: </span><span class="vi">@booking</span> <span class="p">}</span>
    <span class="k">else</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_back</span> <span class="ss">fallback_location: </span><span class="n">root_path</span><span class="p">,</span> <span class="ss">alert: </span><span class="s1">'There was an error confirming your booking.'</span> <span class="p">}</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">status: </span><span class="mi">500</span><span class="p">,</span> <span class="ss">json: </span><span class="vi">@booking</span><span class="p">.</span><span class="nf">errors</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>In our other organizers for creating a booking, canceling, declining or rescheduling, we reuse nearly all the same interactors. While we haven’t followed the DDD methodology to a tee, we’ve encapsulated our domain logic and made it the main focus of our app, and designed around it, making managing our complex business logic easier and clearer.</p>

        </div>
        <a href="/blog/applying-domain-driven-design-principles" class="continue" itemprop="url">continue reading</a>
      
    </div>
  
    <div class='article-item full-article group has-photo' itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      
        <div class="article-image">
            <a href="/blog/on-being-a-parent" itemprop="url">
              <img alt="" src="/images/becoming-parent.png" />
            </a>
        </div>
      
        <div class="article-wrapper">
      
        <h2 class="main-headline" itemprop="name headline">
          <a href="/blog/on-being-a-parent" itemprop="url">
            On Being a Parent
          </a>
        </h2>
        <span class="date">
          <time datetime="2020-05-11T00:00:00-04:00" itemprop="datePublished">
            May 11, 2020
          </time>
        </span>
        <div class='excerpt' itemprop="articleBody">
          <p><img src="/images/becoming-parent.png" alt="" /></p>

<p>“Scott! I need you!!”</p>

<p>“Oh, Meg’s calling me, I got to go. I’ll talk to you later sis.”</p>

<p>I could tell from the sound in her voice what had happened</p>


        </div>
        <a href="/blog/on-being-a-parent" class="continue" itemprop="url">continue reading</a>
      
        </div>
      
    </div>
  
    <div class='article-item full-article group has-photo' itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      
        <div class="article-image">
            <a href="/blog/becoming-a-recurser" itemprop="url">
              <img alt="" src="/images/recurse.png" />
            </a>
        </div>
      
        <div class="article-wrapper">
      
        <h2 class="main-headline" itemprop="name headline">
          <a href="/blog/becoming-a-recurser" itemprop="url">
            Becoming a Recurser
          </a>
        </h2>
        <span class="date">
          <time datetime="2020-05-10T00:00:00-04:00" itemprop="datePublished">
            May 10, 2020
          </time>
        </span>
        <div class='excerpt' itemprop="articleBody">
          <p><img src="/images/recurse.png" alt="" /></p>

<p>I recently had the priveledge to attend the <a href="https://www.recurse.com/">Recurse Center</a>, which if you have not heard of, you should definitely check out. It was a really interesting time to attend, given the current global pandemic we all are finding ourselves in now. The entire experience was moved online,</p>


        </div>
        <a href="/blog/becoming-a-recurser" class="continue" itemprop="url">continue reading</a>
      
        </div>
      
    </div>
  
    <div class='article-item full-article group has-photo' itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      
        <div class="article-image">
            <a href="/blog/zero-downtime-deployments-with-docker-and-digitalocean" itemprop="url">
              <img alt="" src="/images/docker.jpg" />
            </a>
        </div>
      
        <div class="article-wrapper">
      
        <h2 class="main-headline" itemprop="name headline">
          <a href="/blog/zero-downtime-deployments-with-docker-and-digitalocean" itemprop="url">
            Zero Downtime Deployments with Docker and DigitalOcean
          </a>
        </h2>
        <span class="date">
          <time datetime="2019-06-28T00:00:00-04:00" itemprop="datePublished">
            Jun 28, 2019
          </time>
        </span>
        <div class='excerpt' itemprop="articleBody">
          <p><img src="/images/docker.jpg" alt="" /></p>

<p>Previously, <a href="https://www.explorableplaces.com">Explorable Places</a> used Capistrano to deploy to one droplet in DigitalOcean. This setup had a number of downsides and limitations. Among them,</p>


        </div>
        <a href="/blog/zero-downtime-deployments-with-docker-and-digitalocean" class="continue" itemprop="url">continue reading</a>
      
        </div>
      
    </div>
  
    <div class='article-item full-article group has-photo' itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      
        <div class="article-image">
            <a href="/blog/progressive-rendering-with-rails" itemprop="url">
              <img alt="" src="/images/prog.jpg" />
            </a>
        </div>
      
        <div class="article-wrapper">
      
        <h2 class="main-headline" itemprop="name headline">
          <a href="/blog/progressive-rendering-with-rails" itemprop="url">
            Progressive Rendering with Rails
          </a>
        </h2>
        <span class="date">
          <time datetime="2017-08-11T00:00:00-04:00" itemprop="datePublished">
            Aug 11, 2017
          </time>
        </span>
        <div class='excerpt' itemprop="articleBody">
          <p><img src="/images/prog.jpg" alt="" /></p>

<p>At my work, we use <a href="http://markojs.com">Marko</a> as our templating engine, which supports <a href="https://medium.com/ben-and-dion/progressive-rendering-a-killer-and-under-appreciated-feature-of-the-web-97c789b608c1">progressive rendering</a> out of the box. So maybe that is why I took it for granted when I decided I would try to implement the same thing for <a href="https://www.explorableplaces.com">Explorable Places</a>. There are a few pages there that are data-heavy and it would help</p>


        </div>
        <a href="/blog/progressive-rendering-with-rails" class="continue" itemprop="url">continue reading</a>
      
        </div>
      
    </div>
  
</div>

<div class="pagination">
  
    <span class="previous"><</span>
  
  
    
      <span class="active">1</span>
    
  
    
        
          
            <a class="page" href="/page/2">2</a>
          
        
    
  
    
        
          
            <a class="page" href="/page/3">3</a>
          
        
    
  
    
        
          
            <a class="page" href="/page/4">4</a>
          
        
    
  

  
    <a href="/page/2/index" aria-label="next" class="next">></a>
  
</div>


      </section>

      
    </div>

    <footer>
  <div class='footer-inner'>
    &copy; 2020 Scott Davis | Software Engineer, made with &hearts; in <strike>Brooklyn</strike> Washington Heights
  </div>
</footer>


  </body>

</html>
